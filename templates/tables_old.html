{% extends "base2.html" %}

{% block title %}Base de Datos AquaZen - Sistema Inteligente{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Encabezado oceánico -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="p-4 rounded-4 text-white position-relative overflow-hidden"
                 style="background: linear-gradient(135deg, #0c4a6e 0%, #0e7490 25%, #0891b2 50%, #06b6d4 75%, #67e8f9 100%);">
                <!-- Efectos de burbujas animadas -->
                <div class="position-absolute" style="top: 15%; left: 8%; width: 15px; height: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; animation: bubble 8s ease-in-out infinite;"></div>
                <div class="position-absolute" style="top: 70%; right: 12%; width: 20px; height: 20px; background: rgba(255, 255, 255, 0.15); border-radius: 50%; animation: bubble 6s ease-in-out infinite 1s;"></div>
                <div class="position-absolute" style="bottom: 25%; left: 75%; width: 12px; height: 12px; background: rgba(255, 255, 255, 0.08); border-radius: 50%; animation: bubble 10s ease-in-out infinite 3s;"></div>
                
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <svg width="60" height="60" viewBox="0 0 100 100" fill="none">
                                    <circle cx="50" cy="50" r="45" fill="rgba(255, 255, 255, 0.1)" stroke="white" stroke-width="2"/>
                                    <rect x="20" y="30" width="60" height="40" rx="5" fill="rgba(255, 255, 255, 0.15)"/>
                                    <circle cx="35" cy="45" r="3" fill="#fbbf24"/>
                                    <circle cx="65" cy="55" r="2" fill="#ef4444"/>
                                    <path d="M25 65 Q30 60 35 65 Q40 60 45 65" stroke="#10b981" stroke-width="1.5" fill="none"/>
                                    <circle cx="75" cy="40" r="1" fill="white" opacity="0.8"/>
                                    <circle cx="85" cy="60" r="1.5" fill="white" opacity="0.6"/>
                                </svg>
                            </div>
                            <div>
                                <h1 class="fw-bold mb-2" style="font-size: 2.2rem;">Centro de Datos AquaZen</h1>
                                <p class="fs-5 mb-0 opacity-90">Explorador inteligente de base de datos del ecosistema acuático</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 text-end">
                        <div class="d-flex align-items-center justify-content-end">
                            <div class="me-4 text-center">
                                <i class="fas fa-database fs-1 mb-2 d-block opacity-75"></i>
                                <small class="fw-semibold">Datos en Vivo</small>
                            </div>
                            <div class="text-center">
                                <i class="fas fa-chart-line fs-1 mb-2 d-block opacity-75"></i>
                                <small class="fw-semibold">Análisis IA</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Breadcrumb oceánico -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb" style="background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%); border-radius: 15px; padding: 12px 20px; border: 2px solid #a7f3d0;">
            <li class="breadcrumb-item">
                <a href="{{ url_for('index') }}" class="text-decoration-none fw-semibold" style="color: #0891b2;">
                    <i class="fas fa-home me-1"></i>Panel de Control
                </a>
            </li>
            <li class="breadcrumb-item active text-teal-700 fw-semibold" aria-current="page">
                <i class="fas fa-database me-1"></i>Explorador de Datos
            </li>
        </ol>
    </nav>
    <div class="row g-4">
        <!-- Panel de navegación de tablas -->
        <div class="col-lg-4">
            <div class="card card-ocean h-100" style="border-radius: 20px; border: 2px solid #a7f3d0;">
                <div class="card-header" style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); color: white; border: none; border-radius: 18px 18px 0 0; padding: 1.5rem;">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <div class="d-flex align-items-center justify-content-center" 
                                 style="width: 45px; height: 45px; background: rgba(255, 255, 255, 0.2); border-radius: 50%;">
                                <i class="fas fa-table text-white fs-5"></i>
                            </div>
                        </div>
                        <div>
                            <h5 class="mb-1 fw-bold">Tablas del Sistema</h5>
                            <small class="opacity-90">Base de datos SQLite AquaZen</small>
                        </div>
                    </div>
                </div>
                <div class="card-body" style="padding: 1.5rem;">
                    {% if tablas %}
                    <div class="list-group list-group-flush">
                        {% for t in tablas %}
                        <a class="list-group-item list-group-item-action border-0 rounded-3 mb-2 {% if selected_table == t %}active{% endif %}"
                           href="{{ url_for('tables', table=t) }}"
                           style="{% if selected_table == t %}background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); color: white; font-weight: 600;{% else %}background: linear-gradient(135deg, #f0fdfa 0%, #ecfeff 100%); color: #164e63; border: 1px solid #a7f3d0;{% endif %} transition: all 0.3s ease; padding: 12px 16px;"
                           onmouseover="{% if selected_table != t %}this.style.backgroundColor='#cffafe'; this.style.borderColor='#67e8f9'; this.style.transform='translateX(5px)';{% endif %}"
                           onmouseout="{% if selected_table != t %}this.style.backgroundColor=''; this.style.borderColor='#a7f3d0'; this.style.transform='translateX(0)';{% endif %}">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                    <i class="fas {% if t == 'usuarios' %}fa-users{% elif t == 'aspersores' %}fa-fish{% elif 'sensor' in t %}fa-thermometer-half{% elif 'lectura' in t %}fa-chart-line{% else %}fa-database{% endif %} me-3"></i>
                                    <span class="fw-semibold">{{ t }}</span>
                                </div>
                                {% if selected_table == t %}
                                <i class="fas fa-arrow-right"></i>
                                {% endif %}
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-database text-muted fs-2 mb-3 d-block"></i>
                        <p class="text-muted mb-0 fw-semibold">No se encontraron tablas en el sistema</p>
                        <small class="text-muted">Verifique la conexión a la base de datos</small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- Panel principal de datos -->
        <div class="col-lg-8">
            <div class="card card-ocean" style="border-radius: 20px; border: 2px solid #a7f3d0; min-height: 500px;">
                <div class="card-header d-flex justify-content-between align-items-center" 
                     style="background: linear-gradient(135deg, #06b6d4 0%, #67e8f9 100%); color: white; border: none; border-radius: 18px 18px 0 0; padding: 1.5rem;">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <div class="d-flex align-items-center justify-content-center" 
                                 style="width: 45px; height: 45px; background: rgba(255, 255, 255, 0.2); border-radius: 50%;">
                                <i class="fas fa-chart-area text-white fs-5"></i>
                            </div>
                        </div>
                        <div>
                            <h5 class="mb-1 fw-bold">
                                {% if selected_table %}
                                    Datos de {{ selected_table|title }}
                                {% else %}
                                    Explorador de Datos AquaZen
                                {% endif %}
                            </h5>
                            <small class="opacity-90">
                                {% if selected_table %}
                                    Visualización en tiempo real
                                {% else %}
                                    Seleccione una tabla para explorar
                                {% endif %}
                            </small>
                        </div>
                    </div>
                    {% if selected_table %}
                    <div class="d-flex align-items-center gap-3">
                        <span class="badge px-3 py-2 rounded-pill" 
                              style="background: rgba(255, 255, 255, 0.9); color: #0891b2; font-weight: 600;">
                            <i class="fas fa-table me-1"></i>Máx 200 registros
                        </span>
                        <button class="btn btn-light btn-sm px-3 py-2 rounded-3 fw-semibold" 
                                onclick="location.href='{{ url_for('tables', table=selected_table) }}'"
                                style="transition: all 0.3s ease;"
                                onmouseover="this.style.transform='scale(1.05)'"
                                onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-sync-alt me-2"></i>Refrescar
                        </button>
                        {% if selected_table in ['datos_sensores','lecturas_humedad','lecturas_ultrasonico','lecturas_calidad'] %}
                        <form method="post" 
                              action="{% if selected_table == 'datos_sensores' %}{{ url_for('reset_datos_sensores') }}{% else %}{{ url_for('reset_lecturas', sensor_table=selected_table) }}{% endif %}" 
                              onsubmit="return confirm('¿Eliminar todos los registros de {{ selected_table }}? Esta acción no se puede deshacer.');">
                            <button type="submit" class="btn btn-light btn-sm px-3 py-2 rounded-3 fw-semibold" 
                                    style="background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%); border: none; color: #991b1b; transition: all 0.3s ease;"
                                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(220, 38, 38, 0.3)'"
                                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'">
                                <i class="fas fa-trash-alt me-2"></i>Resetear
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                <div class="card-body" style="padding: 2rem;">
                    {% if selected_table %}
                        {% if filas %}
                        <div class="table-responsive" style="border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(14, 116, 144, 0.1);">
                            <table class="table table-hover mb-0" style="background: white;">
                                <thead>
                                    <tr style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);">
                                        {% for col in columnas %}
                                        <th class="text-white fw-semibold" style="padding: 1rem; border: none; font-size: 0.95rem;">
                                            <div class="d-flex align-items-center">
                                                <i class="fas {% if col == 'id' or 'id_' in col %}fa-key{% elif 'fecha' in col or 'timestamp' in col %}fa-clock{% elif 'temperatura' in col %}fa-thermometer-half{% elif 'humedad' in col %}fa-tint{% elif 'distancia' in col or 'distance' in col %}fa-ruler{% elif 'calidad' in col %}fa-water{% elif 'nombre' in col %}fa-tag{% elif 'ubicacion' in col %}fa-map-marker-alt{% elif 'correo' in col %}fa-envelope{% else %}fa-database{% endif %} me-2 text-white" style="font-size: 0.8rem;"></i>
                                                {{ col|title }}
                                            </div>
                                        </th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in filas %}
                                    <tr style="border-color: #cffafe; transition: all 0.2s ease;"
                                        onmouseover="this.style.backgroundColor='#f0fdfa'"
                                        onmouseout="this.style.backgroundColor=''">
                                        {% for col in columnas %}
                                        <td style="padding: 1rem; border-color: #e0f2fe; vertical-align: middle; color: #164e63;">
                                            {% if col == 'id' or 'id_' in col %}
                                                <span class="badge px-2 py-1 rounded-pill" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; font-weight: 600;">{{ row[col] }}</span>
                                            {% elif 'fecha' in col or 'timestamp' in col %}
                                                <span class="text-muted small fw-semibold">{{ row[col] }}</span>
                                            {% elif 'temperatura' in col %}
                                                <span class="text-warning fw-bold">{{ row[col] }}°</span>
                                            {% elif 'humedad' in col %}
                                                <span class="text-primary fw-bold">{{ row[col] }}%</span>
                                            {% elif 'distancia' in col or 'distance' in col %}
                                                <span class="text-success fw-bold">{{ row[col] }}cm</span>
                                            {% elif 'calidad' in col %}
                                                <span class="text-info fw-bold">{{ row[col] }}</span>
                                            {% else %}
                                                <span class="fw-semibold">{{ row[col] }}</span>
                                            {% endif %}
                                        </td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-5">
                            <div class="mb-4">
                                <svg width="80" height="60" viewBox="0 0 100 80" fill="none">
                                    <rect x="10" y="20" width="80" height="45" rx="8" fill="#f0fdfa" stroke="#67e8f9" stroke-width="2"/>
                                    <rect x="13" y="23" width="74" height="39" rx="6" fill="#ecfeff"/>
                                    <circle cx="50" cy="42" r="3" fill="#94a3b8"/>
                                    <path d="M35 55 Q40 50 45 55 Q50 50 55 55 Q60 50 65 55" stroke="#94a3b8" stroke-width="1" fill="none"/>
                                </svg>
                            </div>
                            <h6 class="text-teal-700 fw-bold mb-2">Tabla Vacía</h6>
                            <p class="text-teal-600 mb-0">No hay registros disponibles en <strong>{{ selected_table }}</strong></p>
                            <small class="text-muted">Los datos aparecerán aquí cuando el sistema comience a recopilar información</small>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-5">
                            <div class="mb-4">
                                <svg width="120" height="90" viewBox="0 0 150 120" fill="none">
                                    <!-- Pantalla de datos -->
                                    <rect x="20" y="20" width="110" height="70" rx="8" fill="#f0fdfa" stroke="#67e8f9" stroke-width="2"/>
                                    <rect x="25" y="25" width="100" height="60" rx="5" fill="#ecfeff"/>
                                    <!-- Gráficos simulados -->
                                    <rect x="30" y="35" width="25" height="3" rx="1" fill="#0891b2"/>
                                    <rect x="30" y="42" width="20" height="3" rx="1" fill="#06b6d4"/>
                                    <rect x="30" y="49" width="30" height="3" rx="1" fill="#67e8f9"/>
                                    <!-- Iconos de datos -->
                                    <circle cx="90" cy="45" r="12" fill="#cffafe" stroke="#0891b2" stroke-width="1"/>
                                    <circle cx="90" cy="45" r="3" fill="#0891b2"/>
                                    <rect x="105" y="35" width="15" height="20" rx="2" fill="#a7f3d0"/>
                                    <!-- Base -->
                                    <rect x="30" y="90" width="90" height="8" rx="4" fill="#e0f2fe"/>
                                    <rect x="40" y="98" width="70" height="4" rx="2" fill="#cffafe"/>
                                </svg>
                            </div>
                            <h5 class="text-teal-800 fw-bold mb-3">Explorador de Base de Datos AquaZen</h5>
                            <p class="text-teal-600 mb-4">Seleccione una tabla del panel izquierdo para visualizar sus datos</p>
                            <div class="row g-3 justify-content-center">
                                <div class="col-md-4">
                                    <div class="p-3 rounded-3" style="background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);">
                                        <i class="fas fa-users text-teal-600 fs-4 mb-2 d-block"></i>
                                        <small class="text-teal-700 fw-semibold">Gestión de Clientes</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 rounded-3" style="background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);">
                                        <i class="fas fa-fish text-teal-600 fs-4 mb-2 d-block"></i>
                                        <small class="text-teal-700 fw-semibold">Sistemas Acuáticos</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 rounded-3" style="background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);">
                                        <i class="fas fa-chart-line text-teal-600 fs-4 mb-2 d-block"></i>
                                        <small class="text-teal-700 fw-semibold">Datos de Sensores</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
