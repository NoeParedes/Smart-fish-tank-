{% extends "base2.html" %}

{% block title %}Charts - IRRIGO{% endblock %}

{% block content %}
<div class="container-fluid px-4">
                        <h1 class="mt-4">Sensor Data Charts</h1>
                        <ol class="breadcrumb mb-4">
                            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Dashboard</a></li>
                            <li class="breadcrumb-item active">Charts</li>
                        </ol>
                        <div class="row">
                            <!-- Humidity Chart -->
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-line me-1"></i>
                                        Humidity Sensor Data
                                    </div>
                                    <div class="card-body"><canvas id="humidityChart"></canvas></div>
                                </div>
                            </div>
                            <!-- Water Level Chart -->
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-1"></i>
                                        Water Level Data
                                    </div>
                                    <div class="card-body"><canvas id="waterLevelChart"></canvas></div>
                                </div>
                            </div>
                        </div>
                    </div>
              
        <script>
            // Initialize charts
            const humidityChart = new Chart(document.getElementById('humidityChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Humidity 1 (%)',
                            data: [],
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.2)',
                            fill: true
                        },
                        {
                            label: 'Humidity 2 (%)',
                            data: [],
                            borderColor: 'green',
                            backgroundColor: 'rgba(0, 255, 0, 0.2)',
                            fill: true
                        }
                    ]
                }
            });

            const waterLevelChart = new Chart(document.getElementById('waterLevelChart'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Water Level (%)',
                            data: [],
                            backgroundColor: 'rgba(255, 165, 0, 0.7)',
                            borderColor: 'orange',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Update charts dynamically
            const updateCharts = () => {
                fetch('/get_latest_sensor_data')
                    .then(response => response.json())
                    .then(data => {
                        const { moisture1, moisture2, waterLevel } = data;
                        const timestamp = new Date().toLocaleTimeString();

                        // Update Humidity Chart
                        humidityChart.data.labels.push(timestamp);
                        humidityChart.data.datasets[0].data.push(moisture1);
                        humidityChart.data.datasets[1].data.push(moisture2);
                        if (humidityChart.data.labels.length > 10) {
                            humidityChart.data.labels.shift();
                            humidityChart.data.datasets[0].data.shift();
                            humidityChart.data.datasets[1].data.shift();
                        }
                        humidityChart.update();

                        // Update Water Level Chart
                        waterLevelChart.data.labels.push(timestamp);
                        waterLevelChart.data.datasets[0].data.push(waterLevel);
                        if (waterLevelChart.data.labels.length > 10) {
                            waterLevelChart.data.labels.shift();
                            waterLevelChart.data.datasets[0].data.shift();
                        }
                        waterLevelChart.update();
                    })
                    .catch(error => console.error('Error fetching sensor data:', error));
            };

            setInterval(updateCharts, 5000);
        </script>
{%endblock%}