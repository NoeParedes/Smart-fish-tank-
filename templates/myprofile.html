{% extends "base2.html" %}

{% block title %}MyProfile - IRRIGO{% endblock %}

{% block content %}
<div class="card">
    <h1 class="mt-4">Mi perfil</h1>
    <ol class="breadcrumb mb-4"></ol>
    <div class="card-body text-center">
        <div class="d-flex flex-column align-items-center">
            <!-- Imagen de perfil -->
            <div>
                <img src="/static/assets/img/chillguy.webp" alt="Foto de perfil" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
            </div>
            <!-- Información del usuario -->
            <h4 class="mt-3">{{ usuario.nombre }}</h4>
            <p class="text-muted">{{ usuario.correo }}</p>
        </div>
        <hr>
        <div class="text-start">
            <p><strong>Rol:</strong> {{ usuario.tipo_usuario }}</p>
            <p><strong>Miembro desde:</strong> {{ usuario.fecha_creacion }}</p>
        </div>
        <div class="text-center mt-4">
            <!-- Botón para mostrar el modal -->
            <button id="showModalButton" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#updateModal">Actualizar Información</button>
        </div>
    </div>
</div>

<!-- Modal para actualizar información -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title" id="updateModalLabel">Actualizar Información</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="updateForm">
                    <div class="form-group">
                        <label for="nombre">Nombre</label>
                        <input type="text" id="nombre" name="nombre" class="form-control" value="{{ usuario.nombre }}">
                    </div>
                    <div class="form-group mt-3">
                        <label for="correo">Correo Electrónico</label>
                        <input type="email" id="correo" name="correo" class="form-control" value="{{ usuario.correo }}">
                    </div>
                    <button type="submit" class="btn btn-primary mt-4">Guardar Cambios</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Manejar la lógica de actualización del formulario
    document.getElementById('updateForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const nombre = document.getElementById('nombre').value;
        const correo = document.getElementById('correo').value;

        fetch('/update_user_info', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ nombre, correo })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                location.reload();
            } else {
                alert(data.error || 'Error al actualizar la información');
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>

{% endblock %}
