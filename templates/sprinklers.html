{% extends "base2.html" %}

{% block title %}Peceras - AquaZen{% endblock %}

{% block content %}

    <style>
          /* Ajustar el switch y su posición con colores acuáticos */
    .custom-switch {
        width: 60px;
        height: 25px;
        background-color: #ef4444;
        border-radius: 30px;
        position: relative;
        appearance: none;
        cursor: pointer;
        outline: none;
        transition: background-color 0.3s ease-in-out;
    }

    .custom-switch:checked {
        background-color: #06b6d4;
    }

    .custom-switch::before {
        content: '';
        width: 20px;
        height: 20px;
        background-color: white;
        border-radius: 50%;
        position: absolute;
        top: 2.5px;
        left: 2.5px;
        transition: transform 0.3s ease-in-out;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .custom-switch:checked::before {
        transform: translateX(35px);
    }

    .pecera-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 2px solid rgba(6, 182, 212, 0.2);
        border-radius: 15px;
        background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 50%, #a7f3d0 100%);
    }

    .pecera-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(6, 182, 212, 0.3);
    }

    </style>

                <div class="container mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h1 class="h2 text-cyan-800 mb-1">
                                <svg class="w-8 h-8 me-2 d-inline" fill="currentColor" viewBox="0 0 24 24" width="32" height="32">
                                    <path d="M12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5M12,2A7,7 0 0,1 19,9C19,14.25 12,22 12,22C12,22 5,14.25 5,9A7,7 0 0,1 12,2Z"/>
                                </svg>
                                Sistema de Peceras Inteligentes
                            </h1>
                            <p class="text-cyan-600">Monitoreo y control automático de ecosistemas acuáticos</p>
                        </div>
                        <div>
                            <button class="btn btn-gradient me-2" data-bs-toggle="modal" data-bs-target="#registrarAspersorModal" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border: none;">
                                <i class="fas fa-plus me-1"></i>Nueva Pecera
                            </button>
                            <button class="btn btn-outline-cyan" id="modoAutomaticoManual" style="border-color: #06b6d4; color: #06b6d4;">
                                <i class="fas fa-cog me-1"></i>Automático
                            </button>
                        </div>
                    </div>
            
                    <!-- Mostrar las peceras -->
                    <div class="row">
                        {% for aspersor in aspersores %}
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="card pecera-card h-100 shadow-lg">
                                <div class="card-header text-center" style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); color: white; border: none;">
                                    <h6 class="mb-0 fw-bold">{{ aspersor.nombre }}</h6>
                                </div>
                                <!-- SVG de pecera en lugar de imagen -->
                                <div class="d-flex justify-center py-4">
                                    <svg class="mx-auto" width="150" height="120" viewBox="0 0 200 150" fill="none">
                                        <!-- Pecera -->
                                        <rect x="20" y="40" width="160" height="90" rx="10" fill="rgba(6, 182, 212, 0.2)" stroke="#0891b2" stroke-width="2"/>
                                        <!-- Agua -->
                                        <rect x="25" y="45" width="150" height="80" rx="8" fill="rgba(6, 182, 212, 0.4)"/>
                                        <!-- Peces -->
                                        <ellipse cx="70" cy="75" rx="8" ry="5" fill="#f59e0b" opacity="0.9"/>
                                        <ellipse cx="130" cy="65" rx="6" ry="4" fill="#ef4444" opacity="0.9"/>
                                        <ellipse cx="110" cy="95" rx="10" ry="6" fill="#10b981" opacity="0.9"/>
                                        <!-- Burbujas -->
                                        <circle cx="60" cy="110" r="2" fill="white" opacity="0.7"/>
                                        <circle cx="150" cy="100" r="1.5" fill="white" opacity="0.6"/>
                                        <circle cx="90" cy="120" r="2.5" fill="white" opacity="0.8"/>
                                        <!-- Plantas -->
                                        <path d="M40 125 Q45 110 50 125" stroke="#10b981" stroke-width="1.5" fill="none"/>
                                        <path d="M160 120 Q165 105 170 120" stroke="#10b981" stroke-width="1.5" fill="none"/>
                                    </svg>
                                </div>
                                <div class="card-body text-center">
                                    <p class="text-cyan-700 mb-2"><i class="fas fa-map-marker-alt me-1"></i><strong>Ubicación:</strong> {{ aspersor.ubicacion }}</p>
                                    {% if mostrar_todos %}
                                    <p class="text-muted small mb-3">
                                        <i class="fas fa-user me-1"></i>Propietario: {{ aspersor.nombre_usuario or 'Desconocido' }} (ID: {{ aspersor.id_usuario }})
                                    </p>
                                    {% endif %}
                                    <div class="position-absolute top-0 end-0 p-3">
                                        <div class="form-check form-switch">
                                            <input 
                                                class="form-check-input estado-switch custom-switch" 
                                                type="checkbox" 
                                                role="switch" 
                                                id="estadoSwitch{{ aspersor.id_aspersor }}" 
                                                {% if aspersor.estado == 'activo' %} checked {% endif %} 
                                                data-id="{{ aspersor.id_aspersor }}">
                                        </div>
                                    </div>                                    
                                    <div class="d-flex justify-content-center mt-3 gap-2">
                                        <button class="btn btn-warning btn-sm editar-aspersor" data-id="{{aspersor.id_aspersor}}" data-nombre="{{aspersor.nombre}}" data-ubicacion="{{aspersor.ubicacion}}" data-camera-url="{{aspersor.camera_url or ''}}" data-bs-toggle="modal" data-bs-target="#editarAspersorModal" title="Editar Pecera">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="window.location.href='/calendar/{{ aspersor.id_aspersor}}'" title="Programar Alimentación">
                                            <i class="fas fa-calendar-alt"></i>
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="window.location.href='/camara/{{ aspersor.id_aspersor}}'" title="Ver Cámara en Vivo">
                                            <i class="fas fa-video"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm eliminar-aspersor" data-id="{{aspersor.id_aspersor}}" title="Eliminar Pecera">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            
                <!-- Modal para editar pecera -->
                <div class="modal fade" id="editarAspersorModal" tabindex="-1" aria-labelledby="editarAspersorModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(8, 145, 178, 0.3);">
                            <div class="modal-header" style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 50%, #67e8f9 100%); color: white; border: none;">
                                <h5 class="modal-title fw-bold" id="editarAspersorModalLabel">
                                    <i class="fas fa-fish me-2"></i>Editar Configuración de Pecera
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form method="POST" action="/actualizar_aspersor">
                                <div class="modal-body" style="background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%); padding: 2rem;">
                                    <input type="hidden" id="editarIdAspersor" name="id_aspersor">
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-4">
                                                <label for="editarNombre" class="form-label fw-bold text-teal-800">
                                                    <i class="fas fa-tag me-2 text-teal-600"></i>Nombre de la Pecera
                                                </label>
                                                <input type="text" class="form-control" id="editarNombre" name="nombre" required 
                                                       style="border: 2px solid #67e8f9; border-radius: 10px; padding: 12px; transition: all 0.3s ease;"
                                                       onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 0.2rem rgba(8, 145, 178, 0.25)'"
                                                       onblur="this.style.borderColor='#67e8f9'; this.style.boxShadow='none'">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-4">
                                                <label for="editarUbicacion" class="form-label fw-bold text-teal-800">
                                                    <i class="fas fa-map-marker-alt me-2 text-teal-600"></i>Ubicación
                                                </label>
                                                <input type="text" class="form-control" id="editarUbicacion" name="ubicacion" required
                                                       style="border: 2px solid #67e8f9; border-radius: 10px; padding: 12px; transition: all 0.3s ease;"
                                                       onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 0.2rem rgba(8, 145, 178, 0.25)'"
                                                       onblur="this.style.borderColor='#67e8f9'; this.style.boxShadow='none'">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="editarCameraUrl" class="form-label fw-bold text-teal-800">
                                            <i class="fas fa-video me-2 text-teal-600"></i>URL de Cámara Submarina (Opcional)
                                        </label>
                                        <input type="text" class="form-control" id="editarCameraUrl" name="camera_url" 
                                               placeholder="Ej: http://192.168.18.123:81/stream"
                                               style="border: 2px solid #67e8f9; border-radius: 10px; padding: 12px; transition: all 0.3s ease;"
                                               onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 0.2rem rgba(8, 145, 178, 0.25)'"
                                               onblur="this.style.borderColor='#67e8f9'; this.style.boxShadow='none'">
                                        <small class="form-text text-teal-700 mt-2 d-block">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Introduce la URL de streaming de tu cámara ESP32 para monitoreo en vivo
                                        </small>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%); border: none; padding: 1.5rem;">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal" 
                                            style="border: 2px solid #94a3b8; color: #64748b; padding: 10px 20px; border-radius: 10px; font-weight: 600;">
                                        <i class="fas fa-times me-2"></i>Cancelar
                                    </button>
                                    <button type="submit" class="btn" 
                                            style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); color: white; border: none; padding: 10px 25px; border-radius: 10px; font-weight: 600; box-shadow: 0 4px 15px rgba(8, 145, 178, 0.3);">
                                        <i class="fas fa-save me-2"></i>Guardar Cambios
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal para registrar nueva pecera -->
                <div class="modal fade" id="registrarAspersorModal" tabindex="-1" aria-labelledby="registrarAspersorModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(14, 116, 144, 0.4);">
                            <div class="modal-header" style="background: linear-gradient(135deg, #0e7490 0%, #0891b2 50%, #06b6d4 100%); color: white; border: none; padding: 2rem;">
                                <h5 class="modal-title fw-bold fs-4" id="registrarAspersorModalLabel">
                                    <svg class="me-3" width="32" height="32" viewBox="0 0 100 80" fill="none">
                                        <rect x="10" y="20" width="80" height="45" rx="8" fill="rgba(255, 255, 255, 0.2)" stroke="white" stroke-width="2"/>
                                        <rect x="13" y="23" width="74" height="39" rx="6" fill="rgba(255, 255, 255, 0.1)"/>
                                        <ellipse cx="35" cy="40" rx="6" ry="4" fill="#fbbf24" opacity="0.9"/>
                                        <ellipse cx="65" cy="35" rx="4" ry="3" fill="#ef4444" opacity="0.9"/>
                                        <circle cx="25" cy="55" r="1.5" fill="white" opacity="0.8"/>
                                        <circle cx="75" cy="50" r="1" fill="white" opacity="0.6"/>
                                        <path d="M20 60 Q22 50 24 60" stroke="#10b981" stroke-width="1" fill="none"/>
                                        <path d="M76 58 Q78 48 80 58" stroke="#10b981" stroke-width="1" fill="none"/>
                                    </svg>
                                    Configurar Nueva Pecera Inteligente
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            {% if mostrar_todos %}
                            <form method="POST" action="{{ url_for('crear_aspersor', id_usuario=session['id_usuario']) }}">
                            {% else %}
                            <form method="POST" action="{{ url_for('crear_aspersor', id_usuario=id_usuario_visto) }}">
                            {% endif %}
                                <div class="modal-body" style="background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 50%, #a7f3d0 100%); padding: 2.5rem;">
                                    <div class="text-center mb-4">
                                        <div class="d-inline-flex align-items-center justify-content-center" 
                                             style="width: 80px; height: 80px; background: linear-gradient(135deg, #0891b2, #06b6d4); border-radius: 50%; margin-bottom: 1rem;">
                                            <i class="fas fa-fish text-white" style="font-size: 2rem;"></i>
                                        </div>
                                        <p class="text-teal-700 fs-6">Complete la información para registrar un nuevo sistema de monitoreo acuático</p>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-4">
                                                <label for="nombre" class="form-label fw-bold text-teal-800">
                                                    <i class="fas fa-tag me-2 text-teal-600"></i>Identificador de Pecera
                                                </label>
                                                <input type="text" class="form-control" id="nombre" name="nombre" required 
                                                       placeholder="Ej: Pecera Principal A1"
                                                       style="border: 2px solid #67e8f9; border-radius: 12px; padding: 14px; font-size: 1rem; transition: all 0.3s ease;"
                                                       onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 0.2rem rgba(8, 145, 178, 0.25)'"
                                                       onblur="this.style.borderColor='#67e8f9'; this.style.boxShadow='none'">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-4">
                                                <label for="ubicacion" class="form-label fw-bold text-teal-800">
                                                    <i class="fas fa-map-marker-alt me-2 text-teal-600"></i>Ubicación Física
                                                </label>
                                                <input type="text" class="form-control" id="ubicacion" name="ubicacion" required 
                                                       placeholder="Ej: Laboratorio - Sección B"
                                                       style="border: 2px solid #67e8f9; border-radius: 12px; padding: 14px; font-size: 1rem; transition: all 0.3s ease;"
                                                       onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 0.2rem rgba(8, 145, 178, 0.25)'"
                                                       onblur="this.style.borderColor='#67e8f9'; this.style.boxShadow='none'">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="camera_url" class="form-label fw-bold text-teal-800">
                                            <i class="fas fa-video me-2 text-teal-600"></i>Sistema de Visión Submarina
                                        </label>
                                        <div class="input-group" style="border-radius: 12px; overflow: hidden;">
                                            <span class="input-group-text" style="background: linear-gradient(135deg, #0891b2, #06b6d4); color: white; border: none;">
                                                <i class="fas fa-camera"></i>
                                            </span>
                                            <input type="text" class="form-control" id="camera_url" name="camera_url" 
                                                   value="{{ camera_default_url }}" 
                                                   placeholder="{{ camera_default_url }}"
                                                   style="border: 2px solid #67e8f9; border-left: none; padding: 14px; font-size: 1rem; transition: all 0.3s ease;"
                                                   onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 0.2rem rgba(8, 145, 178, 0.25)'"
                                                   onblur="this.style.borderColor='#67e8f9'; this.style.boxShadow='none'">
                                        </div>
                                        <small class="form-text text-teal-700 mt-2 d-block">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Configure la URL del stream de video para monitoreo visual en tiempo real
                                        </small>
                                    </div>
                                    
                                    <div class="alert" style="background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%); border: 2px solid #67e8f9; border-radius: 12px;">
                                        <h6 class="text-teal-800 mb-2">
                                            <i class="fas fa-lightbulb me-2 text-yellow-500"></i>Características del Sistema
                                        </h6>
                                        <ul class="text-teal-700 mb-0 small">
                                            <li>Monitoreo automático de temperatura y pH</li>
                                            <li>Detección de nivel de agua por ultrasonido</li>
                                            <li>Vigilancia visual con cámara submarina</li>
                                            <li>Alertas inteligentes y control remoto</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%); border: none; padding: 2rem;">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal" 
                                            style="border: 2px solid #94a3b8; color: #64748b; padding: 12px 24px; border-radius: 12px; font-weight: 600; transition: all 0.3s ease;"
                                            onmouseover="this.style.backgroundColor='#f8fafc'; this.style.borderColor='#64748b'"
                                            onmouseout="this.style.backgroundColor='white'; this.style.borderColor='#94a3b8'">
                                        <i class="fas fa-times me-2"></i>Cancelar
                                    </button>
                                    <button type="submit" class="btn" 
                                            style="background: linear-gradient(135deg, #0e7490 0%, #0891b2 50%, #06b6d4 100%); color: white; border: none; padding: 12px 30px; border-radius: 12px; font-weight: 600; box-shadow: 0 6px 20px rgba(14, 116, 144, 0.4); transition: all 0.3s ease;"
                                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(14, 116, 144, 0.5)'"
                                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(14, 116, 144, 0.4)'">
                                        <i class="fas fa-plus me-2"></i>Crear Pecera Inteligente
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
            
                
        <script>
            document.addEventListener("DOMContentLoaded", () => {
            const switches = document.querySelectorAll(".estado-switch");

            switches.forEach((sw) => {
                sw.addEventListener("change", (event) => {
                    // Obtener el ID del aspersor desde el atributo data-id
                    const aspersorId = event.target.dataset.id;
            
                    // Obtener el nuevo estado basado en el interruptor
                    const nuevoEstado = event.target.checked ? "activo" : "inactivo";

                    // Hacer la petición AJAX al servidor
                    fetch(`/actualizar_estado_aspersor`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            id_aspersor: aspersorId,       // Pasar el ID del aspersor
                            estado: nuevoEstado   // Pasar el nuevo estado
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            // Revertir el cambio del switch en caso de error
                            event.target.checked = !event.target.checked;
                        }
                    })
                    .catch(() => {
                        event.target.checked = !event.target.checked;
                    });
                });
            });
        });

        document.addEventListener("DOMContentLoaded", () => {
        const editarButtons = document.querySelectorAll(".editar-aspersor");

        editarButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
            const id = button.dataset.id;
            const nombre = button.dataset.nombre;
            const ubicacion = button.dataset.ubicacion;
            const cameraUrl = button.dataset.cameraUrl || '';

            document.getElementById("editarIdAspersor").value = id;
            document.getElementById("editarNombre").value = nombre;
            document.getElementById("editarUbicacion").value = ubicacion;
            document.getElementById("editarCameraUrl").value = cameraUrl;
                });
            });
        });
        document.addEventListener("DOMContentLoaded", () => {
    const editarButtons = document.querySelectorAll(".editar-aspersor");

    editarButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
            const id = button.dataset.id;
            const nombre = button.dataset.nombre;
            const ubicacion = button.dataset.ubicacion;
            const cameraUrl = button.dataset.cameraUrl || '';

            document.getElementById("editarIdAspersor").value = id;
            document.getElementById("editarNombre").value = nombre;
            document.getElementById("editarUbicacion").value = ubicacion;
            document.getElementById("editarCameraUrl").value = cameraUrl;
        });
    });
});

document.addEventListener("DOMContentLoaded", () => {
    const formEditar = document.querySelector('form[action="/actualizar_aspersor"]');
    formEditar.addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(formEditar);
        const formObject = Object.fromEntries(formData.entries());

        fetch('/actualizar_aspersor', {
            method: 'POST',
            body: JSON.stringify(formObject),
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                location.reload(); // Recargar la página en caso de éxito
            } 
        })
        .catch(error => {
            alert('Hubo un problema con la solicitud');
        });
    });
});


        document.addEventListener("DOMContentLoaded", () => {
    const eliminarButtons = document.querySelectorAll(".eliminar-aspersor");

    eliminarButtons.forEach(button => {
        button.addEventListener("click", (e) => {
            const id = e.target.closest("button").dataset.id;

            if (confirm("¿Estás seguro de que deseas eliminar este aspersor?")) {
                // Petición AJAX para eliminar el aspersor
                fetch(`/eliminar_aspersor`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id_aspersor: id })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.message) {
                        location.reload(); 
                    } else {
                        alert(data.error || "Error al eliminar el aspersor.");
                    }
                })
                .catch(err => {
                    console.error("Error en la solicitud:", err);
                    alert("Error al eliminar el aspersor.");
                });
            }
        });
    });
});


const modoButton = document.getElementById("modoAutomaticoManual");
let modoAutomatico = false;

// Función para habilitar o deshabilitar los interruptores
function toggleSwitches(disabled) {
    const switches = document.querySelectorAll(".estado-switch");
    switches.forEach((sw) => {
        sw.disabled = disabled; // Deshabilitar o habilitar el switch
    });
}

modoButton.addEventListener("click", () => {
    modoAutomatico = !modoAutomatico;
    modoButton.textContent = modoAutomatico ? "Automático" : "Manual";
    
    // Habilitar o deshabilitar los interruptores según el modo
    toggleSwitches(modoAutomatico);

    // Aquí puedes agregar lógica para manejar el cambio de modo en el backend si es necesario
    fetch(`/cambiar_modo`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ modo: modoAutomatico ? "automatico" : "manual" })
    });
});

// Al cargar la página, deshabilitar los interruptores si el modo es automático
document.addEventListener("DOMContentLoaded", () => {
    toggleSwitches(modoAutomatico); // Llama a la función para establecer el estado inicial
});
        </script>

{% endblock %}